<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <!--During development turn off caching-->
    <meta http-equiv="cache-control" content="max-age=0" />
    <meta http-equiv="cache-control" content="no-cache" />
    <meta http-equiv="expires" content="0" />
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
    <meta http-equiv="pragma" content="no-cache" />

    <title></title>

    <!-- <script src="https://appsforoffice.microsoft.com/lib/1/hosted/Office.js" type="text/javascript"></script> -->
    <script src="https://appsforoffice.microsoft.com/lib/beta/hosted/office.js"></script>

    <script>
        // The initialize function must be run each time a new page is loaded
        (function () {
            Office.initialize = function (reason) {
                // console.log("shortcuts: before associates in Office.initialize in functions.html");
                // Office.actions.associate("ShowTaskpane", () => {
                //     console.log("shortcuts: [ShowTaskpane] invoked in Office.initialize in functions.html");
                // });
                // Office.actions.associate("HideTaskpane", () => {
                //     console.log("shortcuts: [HideTaskpane] invoked in Office.initialize in functions.html");
                //     return Office.addin.hide().then(() => { return; }).catch((error) => { return error.code; });
                // });
                // Office.actions.associate("RunAction", () => {
                //     console.log("shortcuts: [RunAction] invoked in Office.initialize in functions.html");
                //     return;
                // });
                // Office.actions.getShortcuts()
                //     .then((shortcuts) => {
                //         for (const action in shortcuts) {
                //             let shortcut = shortcuts[action];
                //             console.log(`shortcuts: ${action}: ${shortcut}`);
                //         }
                // });
                // console.log("shortcuts: after associates in Office.initialize in functions.html");
            };
        })();

        function isLocalhost() {
            if (location && location.origin && location.origin.indexOf("localhost") !== -1) return true;
            if (location && location.host && location.host.indexOf("localhost") !== -1) return true;
            if (location && location.href && location.href.indexOf("localhost") !== -1) return true;

            return false
        }

        function openHelpDesk(event) {
            console.log("inside openHelpDesk");
            var url = isLocalhost() ? 'https://localhost:8000/#/redirect-helpdesk' : undefined;

            Office.context.ui.displayDialogAsync(url,
                { 
                    // height: 70, // except AI Agent for Excel
                    height: 40,
                    width: 50, displayInIframe: true, requireHTTPS: true, promptBeforeOpen: false
                }
            );

            event.completed();
        }

        function safeLog(...args) { try { console.log(...args); } catch {} }

        Office.onReady(async () => {
            try {
                const ksSupported = Office.context?.requirements?.isSetSupported?.("KeyboardShortcuts", "1.1");
                safeLog("shortcuts: [functions.html] KeyboardShortcuts 1.1 supported:", ksSupported);
                safeLog("shortcuts: [functions.html] typeof Office.actions:", typeof Office.actions);
                safeLog("shortcuts: [functions.html] typeof Office.actions.associate:", typeof Office.actions?.associate);
                safeLog("shortcuts: [functions.html] typeof Office.actions.getShortcuts:", typeof Office.actions?.getShortcuts);
            } catch (e) {
                safeLog("shortcuts: [functions.html] capability check error:", e);
            }

            try {
                Office.actions.associate("ShowTaskpane", async () => {
                    safeLog("shortcuts: [ShowTaskpane] invoked (functions.html)");
                    try { await Office.addin.show(); } catch (e) { safeLog("shortcuts: [ShowTaskpane] show error:", e); }
                });

                Office.actions.associate("HideTaskpane", async () => {
                    safeLog("shortcuts: [HideTaskpane] invoked (functions.html)");
                    try { await Office.addin.hide(); } catch (e) { safeLog("shortcuts: [HideTaskpane] hide error:", e); }
                });

                Office.actions.associate("RunAction", () => {
                    safeLog("shortcuts: [RunAction] invoked (functions.html)");
                    // your host-specific work here
                });

                safeLog("shortcuts: [functions.html] actions associated");
            } catch (e) {
                safeLog("shortcuts: [functions.html] associate error:", e);
            }

            // Enumerate shortcuts only if supported (preview API)
            try {
                if (Office.actions && typeof Office.actions.getShortcuts === "function") {
                    const shortcuts = await Office.actions.getShortcuts();
                    safeLog("shortcuts: [functions.html] getShortcuts:", shortcuts);
                } else {
                    safeLog("shortcuts: [functions.html] getShortcuts not available on this client/build");
                }
            } catch (e) {
                safeLog("shortcuts: [functions.html] getShortcuts error:", e);
            }
        });

        // console.log("shortcuts: before associates after Office.onReady in functions.html");
        // Office.actions.associate("ShowTaskpane", () => {
        //     console.log("shortcuts: [ShowTaskpane] invoked after Office.onReady in functions.html");
        // });
        // Office.actions.associate("HideTaskpane", () => {
        //     console.log("shortcuts: [HideTaskpane] invoked after Office.onReady in functions.html");
        //     return Office.addin.hide().then(() => { return; }).catch((error) => { return error.code; });
        // });
        // Office.actions.associate("RunAction", () => {
        //     console.log("shortcuts: [RunAction] invoked after Office.onReady in functions.html");
        //     return;
        // });
        // Office.actions.getShortcuts()
        //     .then((shortcuts) => {
        //         for (const action in shortcuts) {
        //             let shortcut = shortcuts[action];
        //             console.log(`shortcuts: ${action}: ${shortcut}`);
        //         }
        // });
        // console.log("shortcuts: after associates after Office.onReady in functions.html");
    </script>
</head>

<body>
    Function file body is never displayed.
</body>

</html>